<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Forecast Dashboard - Big Data ML</title>
    <link rel="shortcut icon" type="image/x-icon" href="{{ url_for('static', filename='favicon_io/favicon.ico') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/home.css') }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-cloud-sun"></i>
                    <h1>Weather Forecast AI</h1>
                </div>
                <div class="subtitle">
                    <span class="badge">Real-time ML Predictions</span>
                    <span class="tech-stack">Apache Spark • Kafka • MongoDB</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Stats Dashboard -->
    <section class="stats-section">
        <div class="container">
            <div class="row g-4">
                <div class="col-md-3">
                    <div class="stat-card">
                        <div class="stat-icon rain">
                            <i class="fas fa-cloud-rain"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="total-predictions">0</h3>
                            <p>Total Predictions</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card">
                        <div class="stat-icon sunny">
                            <i class="fas fa-sun"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="rain-count">0</h3>
                            <p>Rain Predicted</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card">
                        <div class="stat-icon model">
                            <i class="fas fa-brain"></i>
                        </div>
                        <div class="stat-content">
                            <h3>Random Forest</h3>
                            <p>ML Model</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card">
                        <div class="stat-icon accuracy">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-content">
                            <h3>83.65%</h3>
                            <p>Model Accuracy</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Predictions Table -->
    <section class="predictions-section">
        <div class="container">
            <div class="section-header">
                <h2><i class="fas fa-table"></i> Real-time Predictions</h2>
                <div class="live-indicator">
                    <span class="pulse"></span>
                    <span>Live Streaming</span>
                </div>
            </div>

            <div class="table-container">
                <table class="predictions-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th><i class="fas fa-database"></i> Actual Weather</th>
                            <th><i class="fas fa-robot"></i> Predicted Weather</th>
                            <th><i class="fas fa-tint"></i> Actual Rainfall (mm)</th>
                            <th><i class="fas fa-cloud-showers-heavy"></i> Predicted Rainfall (mm)</th>
                            <th><i class="fas fa-calendar-alt"></i> Date</th>
                            <th><i class="fas fa-clock"></i> Time</th>
                            <th><i class="fas fa-check-circle"></i> Status</th>
                        </tr>
                    </thead>
                    <tbody id="predict-table-body">
                        {% for predict in predicts %}
                        <tr>
                            <td><span class="row-number">{{ loop.index }}</span></td>
                            <td>
                                <span class="weather-badge {{ 'rain-badge' if predict.predict_origin == 'rain' else 'clear-badge' }}">
                                    {% if predict.predict_origin == 'rain' %}
                                        <i class="fas fa-cloud-rain"></i> Rain
                                    {% else %}
                                        <i class="fas fa-sun"></i> No Rain
                                    {% endif %}
                                </span>
                            </td>
                            <td>
                                <span class="weather-badge {{ 'rain-badge' if predict.predict == 'rain' else 'clear-badge' }}">
                                    {% if predict.predict == 'rain' %}
                                        <i class="fas fa-cloud-rain"></i> Rain
                                    {% else %}
                                        <i class="fas fa-sun"></i> No Rain
                                    {% endif %}
                                </span>
                            </td>
                            <td><span class="rainfall-value">{{ "%.2f"|format((predict.get('precip_mm_origin', predict.get('precipMM_origin', 0)))|float) }}</span></td>
                            <td><span class="rainfall-value predicted">{{ "%.2f"|format(predict.rain_prediction|float) }}</span></td>
                            <td><span class="date-text">{{ predict.date }}</span></td>
                            <td><span class="time-text">{{ predict.time }}</span></td>
                            <td>
                                {% if predict.predict_origin == predict.predict %}
                                    <span class="status-badge correct"><i class="fas fa-check"></i> Correct</span>
                                {% else %}
                                    <span class="status-badge incorrect"><i class="fas fa-times"></i> Incorrect</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script type="text/javascript">
        function updateStats(data) {
            $('#total-predictions').text(data.length);
            const rainCount = data.filter(p => p.predict === 'rain').length;
            $('#rain-count').text(rainCount);
        }

        function getStatusBadge(actual, predicted) {
            if (actual === predicted) {
                return '<span class="status-badge correct"><i class="fas fa-check"></i> Correct</span>';
            } else {
                return '<span class="status-badge incorrect"><i class="fas fa-times"></i> Incorrect</span>';
            }
        }

        function getWeatherBadge(weather) {
            if (weather === 'rain') {
                return '<span class="weather-badge rain-badge"><i class="fas fa-cloud-rain"></i> Rain</span>';
            } else {
                return '<span class="weather-badge clear-badge"><i class="fas fa-sun"></i> No Rain</span>';
            }
        }

        function fetchData() {
            var endpoint = window.location.origin + '/get-data';
            $.ajax({
                url: endpoint,
                type: 'GET',
                success: function(data) {
                    updateStats(data);
                    
                    let id = 1;
                    var tableContent = '';
                    data.forEach(function(predict) {
                        const actualRainfall = parseFloat(predict.precip_mm_origin || predict.precipMM_origin || 0).toFixed(2);
                        const predictedRainfall = parseFloat(predict.rain_prediction || 0).toFixed(2);
                        
                        tableContent += '<tr>' +
                            '<td><span class="row-number">' + id++ + '</span></td>' +
                            '<td>' + getWeatherBadge(predict.predict_origin) + '</td>' +
                            '<td>' + getWeatherBadge(predict.predict) + '</td>' +
                            '<td><span class="rainfall-value">' + actualRainfall + '</span></td>' +
                            '<td><span class="rainfall-value predicted">' + predictedRainfall + '</span></td>' +
                            '<td><span class="date-text">' + predict.date + '</span></td>' +
                            '<td><span class="time-text">' + predict.time + '</span></td>' +
                            '<td>' + getStatusBadge(predict.predict_origin, predict.predict) + '</td>' +
                        '</tr>';
                    });

                    $('#predict-table-body').html(tableContent);
                },
                complete: function() {
                    setTimeout(fetchData, 2000);
                }
            });
        }
    
        $(document).ready(function() {
            fetchData();
        });
    </script>
</body>
</html>
